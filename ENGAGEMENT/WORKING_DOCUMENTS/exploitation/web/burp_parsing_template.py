#!/usr/bin/python
from pwn import *
from lxml import etree
from urllib import quote, unquote as u
import json
from sys import argv

context.log_level = 'DEBUG'

def parse_burp_file(
        file_name='traffic.xml'
):
    doc = etree.iterparse(file_name, huge_tree=True)
    requests = []
    for event, node in doc:
        request = {
            'STATUS': '',
            'MIMETYPE': '',
            'RESPONSE': '',
            'PROTOCOL': '',
            'EXTENSION': '',
            'COMMENT': '',
            'URL': '',
            'IP': '',
            'RESPONSELENGTH': '',
            'REQUEST': '',
            'METHOD': '',
            'HOST': '',
            'TIME': '',
            'PATH': '',
            'PORT': ''
        }
        for child in node:
            request[child.tag.upper()] = child.text
            if child.attrib.get('ip'):
                request['IP'] = child.attrib['ip']
        requests.append(request)
    return requests

def main():
    # our business logic (e.g. what to search for) goes here.
    for item in parse_burp_file(argv[1]):
        print(item['REQUEST'].decode('base64'))
        print(item['RESPONSE'].decode('base64'))
